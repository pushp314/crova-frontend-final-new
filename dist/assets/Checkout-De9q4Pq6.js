import{e as R,f as O,c as _,r as t,a as b,j as e,C as $,z as n}from"./index-D7lwuD4-.js";import{T as E}from"./truck-792A5KKl.js";import{P as F}from"./plus-bSVgMRYU.js";const D=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],I=R("shield-check",D),M=()=>{const{cart:o,clearCart:j}=O(),p=_(),[u,v]=t.useState(!1),[h,k]=t.useState([]),[x,g]=t.useState(null),[y,i]=t.useState(!1),[r,d]=t.useState({fullName:"",phone:"",address:"",city:"",state:"",postalCode:"",country:"India"}),[l,C]=t.useState("RAZORPAY");t.useEffect(()=>{if(S(),!window.Razorpay){const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.async=!0,document.body.appendChild(s)}},[]);const S=async()=>{try{const{data:s}=await b.get("/users/addresses");if(s.success){k(s?.data?.addresses||s?.addresses||[]);const a=s?.data?.addresses||s?.addresses||[];a.length>0?g(a[0]):i(!0)}}catch(s){console.error("Error fetching addresses:",s),i(!0)}},z=async()=>{if(!x&&!y){n.error("Please select a shipping address");return}const s=y?r:x;if(!s.address||!s.city||!s.postalCode){n.error("Please provide a complete shipping address");return}v(!0);try{const{data:a}=await b.post("/orders",{items:o.items.map(m=>({variantId:m.variant.id,quantity:m.quantity})),shippingAddress:s,paymentMethod:l});if(!a.success)throw new Error(a.message||"Failed to create order");if(l==="RAZORPAY"){const m={key:a.data.razorpay.key,amount:a.data.razorpay.amount,currency:a.data.razorpay.currency,name:"Crova",description:`Order #${a.data.order.orderNumber}`,order_id:a.data.razorpay.orderId,handler:async function(c){try{(await b.post("/orders/verify-payment",{razorpay_order_id:c.razorpay_order_id,razorpay_payment_id:c.razorpay_payment_id,razorpay_signature:c.razorpay_signature})).data.success&&(j(),p("/order-success",{state:{order:{id:a.data.order.id,orderNumber:a.data.order.orderNumber,totalAmount:a.data.order.totalAmount,paymentStatus:"SUCCESS"}}}))}catch(P){console.error("Payment verification failed:",P),n.error("Payment verification failed. Please contact support.")}},prefill:{name:s.fullName,contact:s.phone,email:"user@example.com"},theme:{color:"#000000"}},A=new window.Razorpay(m);A.on("payment.failed",function(c){n.error(`Payment Failed: ${c.error.description}`)}),A.open()}else j(),p("/order-success",{state:{order:{id:a.data.order.id,orderNumber:a.data.order.orderNumber,totalAmount:a.data.order.totalAmount,paymentStatus:"PENDING"}}})}catch(a){console.error("Order placement error:",a),n.error(a.response?.data?.message||"Failed to place order")}finally{v(!1)}};if(!o||o.items.length===0)return e.jsxs("div",{className:"min-h-screen pt-32 flex flex-col items-center justify-center",children:[e.jsx("h2",{className:"text-2xl font-medium mb-4",children:"Your cart is empty"}),e.jsx("button",{onClick:()=>p("/shop"),className:"underline",children:"Start Shopping"})]});const f=o.items.reduce((s,a)=>s+a.quantity*parseFloat(a.variant?.product?.price||0),0),N=f>4999?0:50,w=f+N;return e.jsx("div",{className:"min-h-screen pt-32 px-4 md:px-12 pb-20 bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-xl font-bold",children:"Shipping Address"})]}),!y&&h.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(s=>e.jsxs("div",{onClick:()=>g(s),className:`p-4 border rounded-lg cursor-pointer transition-all ${x?.id===s.id?"border-black ring-1 ring-black bg-gray-50":"border-gray-200 hover:border-gray-400"}`,children:[e.jsx("p",{className:"font-semibold",children:s.fullName}),e.jsx("p",{className:"text-sm text-gray-600",children:s.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.city,", ",s.state," ",s.postalCode]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.phone})]},s.id))}),e.jsxs("button",{onClick:()=>{g(null),i(!0)},className:"flex items-center gap-2 text-sm font-medium text-blue-600 hover:underline",children:[e.jsx(F,{className:"w-4 h-4"})," Add New Address"]})]}):e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"Full Name",className:"w-full p-3 border rounded-lg",value:r.fullName,onChange:s=>d({...r,fullName:s.target.value})}),e.jsx("input",{placeholder:"Phone Number",className:"w-full p-3 border rounded-lg",value:r.phone,onChange:s=>d({...r,phone:s.target.value})})]}),e.jsx("input",{placeholder:"Street Address",className:"w-full p-3 border rounded-lg",value:r.address,onChange:s=>d({...r,address:s.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"City",className:"w-full p-3 border rounded-lg",value:r.city,onChange:s=>d({...r,city:s.target.value})}),e.jsx("input",{placeholder:"State",className:"w-full p-3 border rounded-lg",value:r.state,onChange:s=>d({...r,state:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"ZIP Code",className:"w-full p-3 border rounded-lg",value:r.postalCode,onChange:s=>d({...r,postalCode:s.target.value})}),e.jsx("input",{placeholder:"Country",className:"w-full p-3 border rounded-lg bg-gray-50",value:r.country,disabled:!0})]}),h.length>0&&e.jsx("button",{type:"button",onClick:()=>i(!1),className:"text-sm text-gray-500 hover:text-black",children:"Cancel"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-xl font-bold",children:"Payment Method"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${l==="RAZORPAY"?"border-black bg-gray-50":"border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"RAZORPAY",checked:l==="RAZORPAY",onChange:()=>C("RAZORPAY"),className:"mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:"Pay Online (Razorpay)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Credit Card, Debit Card, UPI, NetBanking"})]})]}),e.jsxs("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer ${l==="COD"?"border-black bg-gray-50":"border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:"COD",checked:l==="COD",onChange:()=>C("COD"),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cash on Delivery"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Pay when you receive your order"})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 sticky top-32",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 mb-6 max-h-60 overflow-y-auto pr-2",children:o.items.map(s=>e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("div",{className:"w-16 h-20 bg-gray-100 rounded flex-shrink-0 relative overflow-hidden",children:[s.variant?.product?.images?.[0]?e.jsx("img",{src:s.variant.product.images[0].imagePath.startsWith("http")?s.variant.product.images[0].imagePath:`http://localhost:8080${s.variant.product.images[0].imagePath}`,className:"object-cover w-full h-full",alt:""}):e.jsx("div",{className:"w-full h-full bg-gray-200"}),e.jsx("span",{className:"absolute top-0 right-0 bg-black text-white text-xs px-1",children:s.quantity})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium truncate",children:s.variant?.product?.name||"Product"}),e.jsxs("p",{className:"text-gray-500",children:[s.variant?.size," / ",s.variant?.color]}),e.jsxs("p",{className:"font-medium mt-1",children:["₹",(s.variant?.product?.price||0)*s.quantity]})]})]},s.id))}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{children:["₹",f]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping"}),e.jsx("span",{children:N===0?"Free":`₹${N}`})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t mt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",w]})]})]}),e.jsxs("button",{onClick:z,disabled:u,className:"w-full mt-6 py-4 bg-black text-white hover:bg-gray-900 transition-colors rounded-lg font-medium flex items-center justify-center gap-2 disabled:opacity-75",children:[u?"Processing...":`Pay ₹${w}`,!u&&e.jsx(I,{className:"w-4 h-4"})]})]})})]})})};export{M as default};
